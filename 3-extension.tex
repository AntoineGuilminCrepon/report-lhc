%TEX root = main.tex
\section{Description of the extension}

The main point of the extension is to add an object to the language complementary to the $\mathbf{wp}_{\forall}$ from the original model.

This object is defined as such :

\begin{definition}[Weakest existential precondition]
$\WPE{\m{t}}{Q} := \lambda s. \E s' v. \bigstep t s v {s'} \land Q(v)$
\end{definition}

This object behaves in the same way as $\mathbf{wp}_{\forall}$ for most of the rules previously described. Those rules are written down for completeness. Most of the rules can be mirrored as is (just switching a $\mathbf{wp}_{\forall}$ for a $\mathbf{wp}_{\exists}$), but some needs more changes.

\textsc{wp$_{exists}$-exists} mirrors \textsc{wp$_{\forall}$-all}, but uses existential quantifiers instead of universal ones. Without much surprise, $\mathbf{wp}_{\exists}$ works better with existentials. \textsc{wp$_{\exists}$-while$_I$} was modified to take into account the necessity of projectability for $\mathbf{wp}_{\exists}$ statements.

\begin{mathfig}{\small}
    \begin{proofrules}
        \input{rules/wpE-cons.tex}

        \input{rules/wpE-exists.tex}

        \input{rules/wpE-frame.tex}

        \input{rules/wpE-impl-r.tex}

        \input{rules/wpE-subst.tex}

        \input{rules/wpE-idx.tex}

        \input{rules/wpE-seq.tex}

        \input{rules/wpE-assign.tex}

        \input{rules/wpE-if.tex}

        \input{rules/wpE-while.tex}

        \input{rules/wpE-nest.tex}

        \input{rules/wpE-conj.tex}

        \input{rules/wpE-idx-pass.tex}

        \input{rules/wpE-idx-swap.tex}

        \input{rules/wpE-idx-merge.tex}

        \input{rules/wpE-idx-post.tex}
    \end{proofrules}
    \caption{Rules for $\mathbf{wp}_{\exists}$ mirrored on $\mathbf{wp}_{\forall}$}
\end{mathfig}

An interesting point is that predicates that couldn't be defined in the original theory using the base langugage, and thus needed to be explicitly defined to be used, can now be defined using this new $\mathbf{wp}_{\exists}$ object.

\begin{eqnarray*}
    \proj(t) &:=& \WPE{\m{t}}{\True} \\
    t_1 \semleq t_2 &:=& \V s(1)=s(2) |- \WPU{[1: t_1]}{\WPE{[2: t_2]}{v(1) = v(2) \land s(1) = s(2)}}
\end{eqnarray*}

Thus certain rules from LHC can now be rewritten by combining $\mathbf{wp}_{\forall}$ and $\mathbf{wp}_{\exists}$

\begin{mathfig}{\small}
    \begin{proofrules}
        \input{rules/wp-refine.tex}

        \input{rules/wp-proj.tex}
    \end{proofrules}
    \caption{Rules rewritten using $\mathbf{wp}_{\exists}$}
\end{mathfig}

\begin{mathfig}{\small}
    \begin{proofrules}
        \input{rules/wp-triv.tex}
        
        \input{rules/wpU-wpE-swap.tex}
    \end{proofrules}
    \caption{Rules combining $\mathbf{wp}_{\forall}$ and $\mathbf{wp}_{\exists}$ rules}
\end{mathfig}